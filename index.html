<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="BLumia's Dairy Wrapzone" type="application/atom+xml"><link rel="icon" href="/favicon.png"><script src="/easteregg/hi.js"></script><title>BLumia's Dairy Wrapzone</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><div class="page-background"><div id="triangles-4" class="triangles"></div><div id="triangles-5" class="triangles"></div><div id="triangles-6" class="triangles"></div><div id="gradient-overlay-2"></div></div><header class="head"><nav id="nav-menu" class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="/Creative" class="head-nav__link">Creative</a></li><li class="head-nav__item"><a href="/About" class="head-nav__link">About</a></li></ul></nav><h1 class="head-title"><a href="/">BLumia's Dairy Wrapzone</a></h1><h2 class="sub-title">Is that BLumia's Darkness World before?</h2></header><main class="main"><article class="post"><header class="post__head"><time datetime="2018-04-01T13:53:52.000Z" class="post__time">April 1, 2018</time><h1 class="post__title"><a href="/2018/04/01/GoogleSpreadsheetScripting/">编写简单的辅助脚本来在 Google 表格上记账</a></h1></header><div class="post__main echo"><p>我的第二份工作入职在即，而这一次则真的是完全跑到了一个陌生的城市了。租房，购置相关用品，还尚未工作钱就花掉一堆。尽管我个人之前一直都没有过记账的习惯，但为了让自己能够搞清楚自己的钱都花在哪里了，于是还是决定整个超级无敌无脑简单的账本出来。</p>
<p>顺带一提，这篇文章仅仅是写下来记录一下整个过程，其实整个文章并没有多高的技术含量。如果你熟悉 Excel vbs 或者 Google Spreadsheets 脚本的编写而又期望学习一些新的技巧的话，这篇文章不是你想要的文章。</p>
<p>尽管很水，但鉴于这篇文章好歹和技术稍微挂点钩，所以这篇文章我<a href="https://www.cnblogs.com/blumia/p/GoogleSpreadsheetScripting.html" target="_blank" rel="external">同时发布在了 Cnblogs 上</a>，不过 Cnblogs 上的文章自然是少一点关于日常的事情。</p>
<p><img src="http:/blumia.github.io/media/sheet1.png" alt="搞的就这玩意儿"></p>
<p>（注：上图的数据非真实数据）</p>
<h2 id="选型？">选型？</h2><p>首先决定的就是搜索现有的账本工具，而发现一部分账本软件过于复杂，另一部分则是使用他们自己的云服务去存储这些信息。由于感觉自己的需求的确很简单，只需要简单的支出收入计算就可以满足，故最终选择不使用复杂的记账平台和软件。</p>
<p>收入支出计算，差不多就是一个 Excel 就能做到的事情，故开始考虑直接使用 Excel 表格加 vbs 来辅助完成工作。但考虑到我平时需要使用手机处理事情，以及曾经被Excel Online的用户体验“感动”过，我决定使用另一家的服务来做这件事，也就是 Google Spreadsheets 。</p>
<h2 id="开发？">开发？</h2><p>不同于以往写小工具的时候的复杂需求和复杂流程，如果选择使用表格软件完成这个记账任务其实只需要在指定的单元格填填东西编写公式就好了。于是填写好列的表头：时间，内容，数值变动，变动后结果和备注。然后就完事儿了。</p>
<p>作为账本，需要自动计算的东西其实就两个，即从初始金额开始每次数值变动后的“变动后结果”，以及当前页账本整个算下来的余额。而这两个需求其实也非常简单，只需要公式即可完成。其中整页余额只需要找个格子写个 <code>SUM(C4:C200)</code> （假设变动的值从在C列，从行4开始，计算到4到200行值的和）把变动的值加一块儿就行了。而计算当前行金额变动后的结果也很简单，只需把上一行的结果和这一行变动的数值相加即可。在我的这个例子中，即当前单元格的值为这个单元格上方的值加上这个单元格左方的值，即公式 <code>=INDIRECT(&quot;R[-1]C[0]&quot;,false)+INDIRECT(&quot;R[0]C[-1]&quot;,false)</code> 。Tada！一个无脑账本就这么完成了（你什么都没做啊喂！）。</p>
<h2 id="就这么结束了？">就这么结束了？</h2><p><del>由于如果仅仅如此的话，一切的确太过简陋以至于连一篇博客也水不完，</del> 于是还是决定加一点东西进去，即按照颜色标识收入和支出，而这就需要编写简单的脚本处理了。事实上，相比正常的软件开发，这个需求也显得过于简单，所以我们很容易就能得到这种伪代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (这次花的钱钱 &gt; xxx &amp;&amp; 这次花的钱钱 &lt; yyy) &#123;</div><div class="line">	这个格子.设置背景颜色(某个颜色);</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (...) &#123;</div><div class="line">	<span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>于是我们要做的事情就是，翻文档，看看如何做到上面的事情。</p>
<p>大致阅读文档发现代码有一股 JavaScript 的味道，于是就决定先按 js 的语法套路来写，如果出了问题再查。通过查阅文档可知，获得当前表的方式就是 <code>SpreadsheetApp.getActiveSheet()</code> ，而得到现有表格的数据范围（即这个表的数据情况）则是 <code>getDataRange()</code> 了。当我们对得到的数据取值，只需要 <code>getValues()</code> 即可得到一个映射表，而取得数据范围内某个格子则只需 <code>getCell(行, 列)</code> ，相应的，取得单元格的值使用 <code>getValue()</code> ，为单元格设置背景使用 <code>setBackground(&quot;颜色&quot;)</code>。</p>
<p>于是我们就可以通过这些来实现为每一个现有行的收入支出结果那一列标识不同背景颜色的代码了。我们在 工具 &gt; 代码编辑器 编写代码即可，代码也异常简单，如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setDebtColor</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> sheet = SpreadsheetApp.getActiveSheet();</div><div class="line">  <span class="keyword">var</span> range = sheet.getDataRange();</div><div class="line">  <span class="keyword">var</span> data = range.getValues();</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">4</span>; i &lt;= <span class="number">200</span>; i++) &#123; <span class="comment">// index start at 1</span></div><div class="line">    <span class="keyword">if</span> (i &gt; data.length) <span class="keyword">break</span>;</div><div class="line">    <span class="comment">// debt row</span></div><div class="line">    <span class="keyword">var</span> cell = range.getCell(i, <span class="number">3</span>);</div><div class="line">    <span class="keyword">var</span> cellValue = cell.getValue();</div><div class="line">    <span class="keyword">if</span> (cellValue - <span class="number">0</span> &gt; <span class="number">0.001</span>) &#123; <span class="comment">// incoming</span></div><div class="line">      <span class="keyword">if</span> (cellValue &gt; <span class="number">61</span> &amp;&amp; cellValue &lt;= <span class="number">261</span>) cell.setBackground(<span class="string">"#a0c238"</span>);</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (cellValue &gt; <span class="number">261</span>) cell.setBackground(<span class="string">"#0074bf"</span>); </div><div class="line">      <span class="keyword">else</span> cell.setBackground(<span class="string">"#c4fdb3"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cellValue - <span class="number">0</span> &lt; <span class="number">-0.001</span>) &#123; <span class="comment">// outcoming</span></div><div class="line">      <span class="keyword">if</span> (cellValue &lt; <span class="number">-61</span> &amp;&amp; cellValue &gt;= <span class="number">-261</span>) cell.setBackground(<span class="string">"#de9610"</span>);</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (cellValue &lt; <span class="number">-261</span>) cell.setBackground(<span class="string">"#c93a40"</span>); </div><div class="line">      <span class="keyword">else</span> cell.setBackground(<span class="string">"#fffacd"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      cell.setBackground(<span class="literal">null</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上我们假设C列的4~200行为需要填色的格子，为支出填红色，收入填绿色（大致..），并根据两个阈值（61和261，别问为啥是这个数）把收入或支出的量的多少分为三段填以不同深浅程度的颜色。填充到最后就完成啦。有意思的是，写这段代码之前我完全不熟悉 Spreadsheet 脚本语言的用法（vbs我也不熟悉…），这样竟然没碰到语法错误…</p>
<p>值得一提的是，其一，<code>getCell()</code> 的下标是从 1 开始的，头一次点调试发现内容那一列变色了，当时还觉得挺好看，后来才反应过来不对。另一个是，由于实在懒得去系统的了解这一套脚本语言编写方式之类，故我也没有研究有没有浮点数比较运算的问题，于是对于判断等于0这一点，用了上面写的那种方法。</p>
<h2 id="尾声？">尾声？</h2><p><del>我终于又水了一篇博客</del>，于是对于码农来说，能快速翻阅文档查 API 手册来完成自己想要的任务，应该算是基本素养吧。（写这么一篇博客花的时间是写那一小段脚本的三倍多了吧</p>
<p>更重要的是终于知道我的小钱钱都去哪里了（不对</p>
<p>实际上之前的那份工作，由于本身和我的大学在同一个市里，公司提供住宿，并且也有学长在那里，故和这份新工作相比而言，这份新工作才真的算是让我来到了一个完全陌生的城市吧。坦白说初来这两天，心里的五味瓶翻掉了，也没人可以倾诉，心里憋着实在难受，于是才打算写这么一篇博客换心情。我不知道是不是来到陌生城市的人们最初是不是都会有这种感受，我仿佛完全失去了憧憬未来的能力一般，但我又能做什么呢？房屋租下了，明天就是入职的日子了，这份新工作我寄予了很大的希望在上面，而现在我反而有些惧怕。无论这即将到来的工作带来的是愉快的工作经历还是失望的经历，至少这三个月的生活已经随着租房合同的签订而敲定了。当然，谁不希望一切向着好的方向发展呢？希望一切安好吧。</p>
<p>明天就是新工作入职第一天，水一篇博客，希望一切顺利。</p>
<p>2018年4月1日21点50分</p>
</div><footer class="post__foot u-cf"><a href="/2018/04/01/GoogleSpreadsheetScripting/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2018-01-07T16:20:20.000Z" class="post__time">January 8, 2018</time><h1 class="post__title"><a href="/2018/01/08/2018-Time-Capsule/">TimeCapsule - 2018</a></h1></header><div class="post__main echo"><p>由于去年时间囊开囊的惨况以及某种程度上我对某些事情认知的改变，今年的时间囊或许会再换一种形式。jjjjy 曾说时间囊是一点用处都没有的，而我的本意其实是记录一下我一年内的愿景，而不是列出一些 TODO 目标来去实现。记录下来这些东西也会督促我自己去向着更接近正确或者更向上的方向发展而不是颓废（尽管已经很颓了），所以我觉得还是很有必要记一下的。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/时间囊/" class="post__tag__link">时间囊</a></li></ul><a href="/2018/01/08/2018-Time-Capsule/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-12-28T16:26:08.000Z" class="post__time">December 29, 2017</time><h1 class="post__title"><a href="/2017/12/29/Unbox-2017TimeCapsule/">2017年末小结</a></h1></header><div class="post__main echo"><p>今年的时间囊开囊大概特别惨，于是这次开囊之外还会带一些别的东西，也回归到 “年末小结” 的主题。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/时间囊/" class="post__tag__link">时间囊</a></li></ul><a href="/2017/12/29/Unbox-2017TimeCapsule/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-09-28T09:05:31.000Z" class="post__time">September 28, 2017</time><h1 class="post__title"><a href="/2017/09/28/write-a-simple-udp-tunnel-using-tun-device/">使用 TUN 设备实现一个简单的 UDP 代理隧道</a></h1></header><div class="post__main echo"><p>若要实现在 Linux 下的代理程序，方法有很多，比如看着 <a href="https://www.ietf.org/rfc/rfc1928.txt">RFC 1928</a> 来实现一个 socks5 代理并自行设置程序经过 socks5 代理等方式，下文是使用 Linux 提供的 <code>tun/tap</code> 设备来实现 UDP 代理隧道的大体思路和过程讲解。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/网络编程/" class="post__tag__link">网络编程</a></li></ul><a href="/2017/09/28/write-a-simple-udp-tunnel-using-tun-device/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-06-04T17:58:18.000Z" class="post__time">June 5, 2017</time><h1 class="post__title"><a href="/2017/06/05/revert-to-2013/">git reset --hard v2013</a></h1></header><div class="post__main echo"><p>说起来我大概有一整个学期的时间都在做调整心态这一件事吧，而因为这个问题我一直实在不知道如何处理，我状态变差似乎变得愈演愈烈停不下来了。大三下学期末我们就都被要求除考研学生外别的学生不得住校，于是我不得不选择把我的宿舍的所有东西都清空，一些搬不走的东西就等着被丢掉，却无意间漏收拾了我高中时期的日记本，好在我同学注意到了那个本子并帮我收拾起来了，我也在上周回校拿回了那个本子。昨晚心态依然不好，想到拿回了日记本，就开始翻看我之前写的东西，翻着翻着，我好像发现，从那时候到现在，我好像遗失了一些东西…</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/土产日杂/" class="post__tag__link">土产日杂</a></li></ul><a href="/2017/06/05/revert-to-2013/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-06-04T17:58:18.000Z" class="post__time">June 5, 2017</time><h1 class="post__title"><a href="/2017/06/05/dairy-before-intern/">写于实习前</a></h1></header><div class="post__main echo"><p>说是写于实习前，但实习其实还有一段时间 [^1] ，今晚有点时间，简要记一下这段时间的事情吧。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/土产日杂/" class="post__tag__link">土产日杂</a></li></ul><a href="/2017/06/05/dairy-before-intern/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-04-29T18:10:52.000Z" class="post__time">April 30, 2017</time><h1 class="post__title"><a href="/2017/04/30/random_stuff_about_these_days2/">随便记一些事情 2</a></h1></header><div class="post__main echo"><p>既然是 2 ，那这篇的内容自然和 1 有关，这篇本来也没计划要写，不过现在想来也的确有东西写。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/土产日杂/" class="post__tag__link">土产日杂</a></li></ul><a href="/2017/04/30/random_stuff_about_these_days2/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-04-11T17:40:52.000Z" class="post__time">April 12, 2017</time><h1 class="post__title"><a href="/2017/04/12/random_stuff_about_these_days/">随便记一些事情</a></h1></header><div class="post__main echo"><p>写这篇也算不上突发奇想，不过也的确是想记一些东西，给脑子倒倒垃圾。惯例，以下内容可能非常乱且没有任何头绪。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/土产日杂/" class="post__tag__link">土产日杂</a></li></ul><a href="/2017/04/12/random_stuff_about_these_days/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-02-28T14:26:17.000Z" class="post__time">February 28, 2017</time><h1 class="post__title"><a href="/2017/02/28/Thats-JavaScript-1/">原来JS是这样的 (1)</a></h1></header><div class="post__main echo"><h2 id="引子">引子</h2><p>长久以来一直都没有专门学过 JS ，因为之前有自己啃过 C++ ，又打过一段时间的算法竞赛（写得一手好意大利面条），于是自己折腾自己的网站的时候，一直都把 JS 当 C 写。但写的时候总会遇到一些奇怪的问题，于是打算花点时间看了看《你不知道的JavaScript》。写这篇文章以记录一下一段时间的学习内容，也治疗一下我不爱做笔记和总结的毛病。如果你也是一直按着别的语言的编程习惯来写 JS 而没有专门去了解过它，不妨一起来了解一下 JS 的一些独特之处。</p></div><footer class="post__foot u-cf"><a href="/2017/02/28/Thats-JavaScript-1/#more" class="post__more u-fr">READ MORE</a></footer></article><article class="post"><header class="post__head"><time datetime="2017-02-08T18:11:46.000Z" class="post__time">February 9, 2017</time><h1 class="post__title"><a href="/2017/02/09/laji-coolpad/">关于不要买辣鸡酷派</a></h1></header><div class="post__main echo"><p>其实压根没想到会有这么一篇。我感觉我黑过红米，黑过wp，然后当我拿到手一部酷派大神F2的时候，我觉得我都应该给某米和某软道歉了。于是这么一篇，可以当个故事段子看。</p></div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/土产日杂/" class="post__tag__link">土产日杂</a></li><li class="post__tag__item"><a href="/tags/安卓/" class="post__tag__link">安卓</a></li><li class="post__tag__item"><a href="/tags/刷机/" class="post__tag__link">刷机</a></li></ul><a href="/2017/02/09/laji-coolpad/#more" class="post__more u-fr">READ MORE</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2018 <a onclick='high();'>BLumia</a></div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><a title="Next" href="/page/2/" class="page-menu__link icon-arrow-right"></a></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="https://"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","blogblumia","count");
</script></body></html>